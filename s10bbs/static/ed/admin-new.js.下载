function AjaxPost(n,t,i){$.ajax({url:n,data:t,type:"post",dataType:"json",contentType:"application/json; charset=utf8",success:function(n){n.d&&i(n.d)},error:function(){}})}function loadCurrentUser(){$.ajax({url:location.protocol+"//passport"+hostPostfix+"/user/LoginInfo",dataType:"jsonp",success:function(n){$("#top_nav #right").html(n);var t=parseInt($("#current_spaceId").html());t>0&&$.ajax({url:location.protocol+"//passport"+hostPostfix+"/user/NewMsgCount",data:"spaceUserId="+t,dataType:"jsonp",success:function(n){n&&$("#msg_count").html("("+n+")")}})}})}function insertTag(){var n=document.getElementById("Editor_Edit_Advanced_txbTag");n.value+=n.value==""?tagname:","+tagname}function insertDescImg(){var n=prompt("请输入图片网址","http://"),t;return n?(t='<img src="'+n+'" class="desc_img"/>',document.getElementById("Editor_Edit_Advanced_txbExcerpt").value=t+document.getElementById("Editor_Edit_Advanced_txbExcerpt").value,document.getElementById("Editor_Edit_Advanced_txbExcerpt").focus(),!1):!1}function CheckInput(){var i=$.trim(document.getElementById(txbTitleId).value),r=$.trim(getBlogEditorContent()),n="",t;return(i==""&&(n="请输入标题！"),r==""&&(n!=""&&(n+="\n"),n+="请输入内容！"),t=!1,$.ajax({url:"/mvc/user/IsAuthenticated.aspx",async:!1,success:function(i){t=i;t||(n="提交失败！失败原因：当前登录已过期！切记不要关闭当前窗口！\n请打开新窗口，访问 http://passport.cnblogs.com/login.aspx ，成功登录后，再回到该窗口进行提交")},error:function(t){n="提交失败！失败原因：\n"+t.responseText.replace(/(<([^>]+)>)/ig,"")}}),n!="")?(alert(n),!1):(BypassCheck(),!0)}function PubishConfirm(n){n.checked&&(confirm("友情提醒：\n博客园首页是万众瞩目的地方，一定要是精品文章哦:)\n确认要发布到博客园首页吗?")||(n.checked=!1))}function BypassCheck(){g_blnCheckUnload=!1}function CancelPost(){return isWriteSomething()?confirm("确认取消吗？")?(BypassCheck(),!0):!1:!0}function canLeavePage(){return(localPreserver.saveDraftTitle(),localPreserver.saveDraftBody(),!g_blnCheckUnload)?!0:isWriteSomething()?!1:!0}function isWriteSomething(){return $.trim(document.getElementById(txbTitleId).value)!=""?!0:$.trim(getBlogEditorContent())!=""?!0:!1}function getBlogEditorContent(){return blogEditor.getContent()}function setBlogEditorContent(n){blogEditor.setContent(n)}function CheckEntryName(){var t=$("#Editor_Edit_Advanced_txbEntryName").val(),i,n;if(t){if(i=/^[a-zA-Z0-9][\w-_]{1,149}$/g,!i.test(t)){$("#entryname_tip").css("color","red").html("EntryName只能使用字母、数字、-、_，不能超过150个字符");return}n=$("#currentPostId").html();n==""&&(n="0");$("#entryname_tip").css("color","red").html("正在检查EntryName是否有同名...");$.ajax({url:"/admin/ws/EntryAdmin.asmx/IsEntryNameExist",data:'{"entryId":'+n+',"entryName":"'+t+'"}',success:function(n){n.d?$("#entryname_tip").html("已存在同名的EntryName，请更改！"):$("#entryname_tip").css("color","green").html("检查通过")},error:function(n){$("#entryname_tip").css("color","red").html(n.responseText)}})}}function OnHomeCandidateChange(n){if(n.checked){var t=document.getElementById("Editor_Edit_APOptions_APSiteHome_cbIsPublishToSiteHome");t&&t.checked&&(t.checked=!1)}}function OnSiteHomeChange(n){if(n.checked){var t=document.getElementById("Editor_Edit_APOptions_APSiteHome_cbHomeCandidate");t&&t.checked&&(t.checked=!1)}}function HandleTabKey(n){if(n.keyCode==9){var t=document.getElementById(currentEditorId);t.PasteHTML("　　");n.preventDefault?n.preventDefault():n.returnValue=!1;t.FocusDocument()}}function CuteEditor_attachEvents(){var t=document.getElementById(currentEditorId),n=t.GetDocument();n.attachEvent?n.attachEvent("onkeydown",HandleTabKey):n.addEventListener&&n.addEventListener("keydown",HandleTabKey,!0)}function CuteEditor_detachEvents(){var t=document.getElementById(currentEditorId),n=t.GetDocument();n.detachEvent?n.detachEvent("onkeydown",HandleTabKey):n.removeEventListener&&n.removeEventListener("keydown",HandleTabKey,!0)}function CuteEditor_OnInitialized(){CuteEditor_attachEvents()}function title_keydown(n){n.keyCode==9&&(n.preventDefault?n.preventDefault():n.returnValue=!1,currentUseEditor==1?document.getElementById(currentEditorId).FocusDocument():currentUseEditor==3?tinyMCE.get(currentEditorId).focus():document.getElementById(currentEditorId).focus())}function localPreserver(){}function deletePost(n){var i,t;if(n<=0||(i=$("#post_title_link_"+n).html(),!confirm("确认删除“"+i+"”吗？")))return!1;t=$("#post-row-"+n);$(t).html(deletePostTip("删除操作中..."));$.ajax({url:"/post/delete",type:"post",data:'{"postId":'+n+"}",contentType:"application/json",dataType:"json",success:function(n){n.isSuccess?$(t).html(deletePostTip("删除成功！")):$(t).html(deletePostTip("删除失败！"+n.msg))},error:function(n){$(t).html(deletePostTip("操作出错！"+n.responseText))}})}function deletePostTip(n){return"<td colspan='7' style='text-align:left'><span style='color:red'>"+n+"<\/span><\/td>"}function categoryController(n,t){$.ajax({url:"/categories",type:"get",dataType:"json",success:function(i){i&&i.length>0&&(n.call(this,i),t.call(this,i))}})}function showCategories(n){for(var t,r='<li><a href="/posts?categoryid=0">[未分类]<\/a><\/li>',i=0;i<n.length;i++)t=n[i],r+='<li><a href="/posts?categoryid='+t.CategoryId+'" id="category_'+t.CategoryId+'">'+t.Title+"<\/a><\/li>";$("#post_categories").append(r)}function showPostCounts(n){var t=$.map(n,function(n){return n.CategoryId});$.ajax({url:"/categories/postcounts",type:"post",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){for(var r,i=0;i<n.length;i++)r=t[n[i].CategoryId.toString()],r===undefined&&(r=0),$("#category_"+n[i].CategoryId).append("("+r+")")}})}function logout(){return confirm("确认退出吗？")&&(location.href="http://passport.cnblogs.com/logout.aspx?ReturnUrl=http://www.cnblogs.com"),!1}var g_blnCheckUnload=!0,hostPostfix=location.host.match(/\..+$/g)[0],blogEditor;$.ajaxSetup({type:"post",dataType:"json",contentType:"application/json; charset=utf-8"});blogEditor={};blogEditor.getTitle=function(){return $("#Editor_Edit_txbTitle").val()};blogEditor.setTitle=function(n){$("#Editor_Edit_txbTitle").val(n)};blogEditor.getContent=function(){var n,t;return n=currentUseEditor==1?document.getElementById(currentEditorId).GetDocument().body.innerHTML:currentUseEditor==3?tinyMCE.get(currentEditorId)?tinyMCE.get(currentEditorId).getContent():document.getElementById(currentEditorId).value:document.getElementById(currentEditorId).value,t=/^\s*<br>\s*$/ig,t.test(n)&&(n=""),n};blogEditor.setContent=function(n){currentUseEditor==1?document.getElementById(currentEditorId).GetDocument().body.innerHTML=n:currentUseEditor==3?tinyMCE.get(currentEditorId)?editorContent=tinyMCE.get(currentEditorId).setContent(n):document.getElementById(currentEditorId).value=n:document.getElementById(currentEditorId).value=n};blogEditor.restoreContent=function(n){n.indexOf("<p>---恢复内容开始---<\/p>")<0&&(n="<p>---恢复内容开始---<\/p>"+n+"<p>---恢复内容结束---<\/p>");currentUseEditor==1?document.getElementById(currentEditorId).GetDocument().body.innerHTML=n+document.getElementById(currentEditorId).GetDocument().body.innerHTML:currentUseEditor==3?tinyMCE.get(currentEditorId)?editorContent=tinyMCE.get(currentEditorId).setContent(n+tinyMCE.get(currentEditorId).getContent()):document.getElementById(currentEditorId).value=n+document.getElementById(currentEditorId).value:document.getElementById(currentEditorId).value=n+document.getElementById(currentEditorId).value};localPreserver.draftBodyKey="DraftBody";localPreserver.draftTitleKey="DraftTitle";localPreserver.saveDraftTitle=function(){if(isNewPost&&window.localStorage){var n=blogEditor.getTitle();n&&localStorage.setItem(localPreserver.draftTitleKey,n)}};localPreserver.saveDraftBody=function(){var n,t;window.localStorage?(n=blogEditor.getContent(),n&&n.length>10&&(t=localStorage.getItem(localPreserver.draftBodyKey),t!=n&&(localStorage.setItem(localPreserver.draftBodyKey,n),$("#write_hint").css("color","green").html("本地自动保存于"+(new Date).toLocaleTimeString()+'，<a href="javascript:void(0);" onclick="localPreserver.showSaved();return false;">查看<\/a>')))):$("#write_hint").css("color","green").html("当前浏览器不支持HTML5，无法启用本地自动保存功能")};localPreserver.showSaved=function(){var n=localStorage.getItem(localPreserver.draftTitleKey),t;n||(n="无标题");n+='<span style="float:right"><a href="javascript:void(0);" onclick="localPreserver.loadDraft();$.cnblogs_close();return false;">恢复<\/a><\/span>';t=localStorage.getItem(localPreserver.draftBodyKey);$.cnblogs_bind({title:n,content:t,width:"710px"})};localPreserver.showViewTip=function(){localStorage.getItem(localPreserver.draftBodyKey)&&$("#write_hint").css("color","green").html('<a href="javascript:void(0);" onclick="localPreserver.showSaved();return false;">查看自动保存内容<\/a>')};localPreserver.loadDraft=function(){if(window.localStorage){editorContent=blogEditor.getContent();var n=localStorage.getItem(localPreserver.draftBodyKey);n&&blogEditor.restoreContent(n)}};localPreserver.clearDraft=function(){window.localStorage&&(localStorage.removeItem(localPreserver.draftTitleKey),localStorage.removeItem(localPreserver.draftBodyKey))};$(function(){loadCurrentUser()});$(function(){new categoryController(showCategories,showPostCounts)})